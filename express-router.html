<link rel="import" href="../polymer/polymer.html">

<dom-module id="express-router">
    <script>
        class ExpressRouterComponent {

            beforeRegister() {
                this.is = 'express-router';
                this.properties = {
                    path: {
                        type: String
                    }
                };
            }

            ready() {}
            attached() {}
            detached() {}
            attributeChanged() {}

            init(app, newExpress, router, route) {
                this.app = app;
                this.router = router;

                const express = require('express');
                const newRouter = express.Router();

                if (this.parentRouter) {
                    this.parentRouter.use(this.path, newRouter);
                }
                else {
                    this.app.use(this.path, newRouter);
                }

                const children = Array.from(this.children);
                children.forEach((child) => {
                    if (!child.init) {
                        const init = (app, express, router, route) => {

                            const children = Array.from(this.children);
                            children.forEach((child) => {
                                if (!child.init) {
                                    child.init = init;
                                }

                                child.init(app, express, router, route);
                            });
                        };

                        child.init = init;
                    }

                    child.init(this.app, express, newRouter, route);
                });
            }
        }

        Polymer(ExpressRouterComponent);
    </script>
</dom-module>
