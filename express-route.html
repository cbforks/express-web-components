<script>
    class ExpressRouteComponent extends HTMLElement {
        constructor() {
            super();

            this.path = null;
        }

        static get observedAttributes() {
            return [
                'path'
            ];
        }

        attributeChangedCallback(name, oldValue, newValue) {
            switch (name) {
                case 'path': {
                    this.path = newValue;
                    break;
                }
            }
        }

        init(app, express, router, route) {
            const parent = getParent(app, router);
            const newRoute = parent.route(this.path);

            const children = Array.from(this.children);
            children.forEach((child) => {

                //TODO this code is repeated exactly in express-app.html and express-router.html
                if (!child.init) {
                    const init = function(app, express, router, route) {

                        const children = Array.from(this.children);
                        children.forEach((child) => {
                            if (!child.init) {
                                child.init = init;
                            }

                            child.init(app, express, router, route);
                        });
                    };

                    child.init = init;
                }
                //TODO this code is repeated exactly in express-app.html and express-router.html

                child.init(app, express, router, newRoute);
            });

            function getParent(app, router) {
                if (router) {
                    return router;
                }
                else {
                    return app;
                }
            }
        }
    }

    window.customElements.define('express-route', ExpressRoute);
</script>
